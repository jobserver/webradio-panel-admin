app.controller("programacao",function(a,e,f,g,h,k,d,l){a.lista=[];a.ordenacao={campo:"data_inicio",direcao:"desc"};a.CampoBuscar=null;a.form={};a.formHorario={};a.progEdit={};a.ordernar=function(b){a.ordenacao.direcao="asc"==a.ordenacao.direcao?"desc":"asc";a.ordenacao.campo=b;a.getBusca(0,a.CampoBuscar)};a.lerPrograma=function(b){b.data_inicio=d("toDate")(b.data_inicio);b.data_fim=d("toDate")(b.data_fim);a.form=b};a.novoPrograma=function(){a.form={radio_codigo:a.radioId}};a.horario=function(b){$("#modalHorario").modal("open");
a.progEdit=b;a.formHorario={radio_codigo:a.radioId,programacao_id:b.id}};a.editarHorario=function(b,c){a.progEdit=c;a.formHorario=angular.copy(b);a.formHorario.hora_inicio=new Date("2020-06-01T"+a.formHorario.hora_inicio);a.formHorario.hora_fim=new Date("2020-06-01T"+a.formHorario.hora_fim);$("#modalHorario").modal("open")};a.excluirHorario=function(){$("#modalProcessando").modal("open");e.post(a.instalacao+"/admin/gradeprogramacao/apagar",{id:a.formHorario.id}).then(function(b){$("#modalProcessando").modal("close");
$("#modalHorario").modal("close");M.toast({html:b.data.status.frase,classes:b.data.status.classe});a.getBusca()},function(a){$("#modalProcessando").modal("close");M.toast({html:"Falha ao excluir. Verifiqe sua conex\u00e3o ou tente mais tarde.",classes:"red"})})};a.getBusca=function(b,c){b=void 0===b?0:b;c=void 0===c?"":c;$("#modalProcessando").modal("open");e({method:"POST",url:a.instalacao+"/admin/programacao/get/"+b,data:{filtro:c,ordenacao:a.ordenacao},headers:{"Content-Type":"application/x-www-form-urlencoded",
"Cache-Control":"no-cache"},timeout:3E4}).then(function(b){a.lista=b.data;$("#modalProcessando").modal("close");$("#CampoBuscar").focus()},function(a){$("#modalProcessando").modal("close");M.toast({html:"Falha ao carregar dados. Verifiqe sua conex\u00e3o ou tente mais tarde.",classes:"red"})})};a.events=[];a.getProgramacao=function(){e({method:"GET",url:a.instalacao+"/admin/programacao/grade",headers:{"Cache-Control":"no-cache"}}).then(function(b){a.calendarOptions={defaultView:"agendaWeek",height:500,
nowIndicator:!0,locale:"pt-br",timeFormat:"H(:mm)",header:{right:"prev,next",center:"title",left:"agendaWeek,listWeek,agendaDay"}};a.events=b.data;$("#calendario").fullCalendar("rerenderEvents")})};a.getProgramacao();a.salvarHorario=function(){$("#modalProcessando").modal("open");var b=angular.copy(a.formHorario);b.hora_inicio=d("date")(b.hora_inicio,"HH:mm:ss","UTC-3h");b.hora_fim=d("date")(b.hora_fim,"HH:mm:ss","UTC-3h");e.post(a.instalacao+"admin/gradeProgramacao/salvar",b).then(function(b){$("#modalProcessando").modal("close");
$("#modalHorario").modal("close");M.toast({html:b.data.status.frase,classes:b.data.status.classe});a.getBusca()})["catch"](function(a){$("#modalProcessando").modal("close");M.toast({html:"Erro ao salvar, tente mais tarde",classes:"red"})})["finally"](function(){$("#modalProcessando").modal("close")})};a.salvar=function(){var b=new FormData,c=document.getElementById("foto_locutor").files[0];b.append("foto_locutor",c);var d=document.getElementById("foto_programa").files[0];b.append("foto_locutor",c);
b.append("foto_programa",d);b.append("dados",angular.toJson(a.form));$("#modalProcessando").modal("open");e({method:"POST",url:a.instalacao+"/admin/programacao/salvar",data:b,transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(b){$("#modalProcessando").modal("close");M.toast({html:b.data.status.frase,classes:b.data.status.classe});a.getBusca();$("#modalPrograma").modal("close")})["catch"](function(a){$("#modalProcessando").modal("close");M.toast({html:"Erro ao salvar, tente mais tarde",
classes:"red"})})["finally"](function(){$("#modalProcessando").modal("close")})}});